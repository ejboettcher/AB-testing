---
title: "Power of A/B Testing"
subtitle: "Beyond user feedback"
bibliography: references.bib
author: Evelyn J. Boettcher
format:
    revealjs:
        incremental: false
fig-cap-location: margin
date: Nov 16th, 2022
---

## A / B Testing { background-image='img/bluebox.svg' background-size="100% 100% " background-position="0%  center" }

A/B testing is a **randomized** controlled experiment done in production.

<br>
There are two tests: A and B, in which a single variable adjusted (B Test).
<br>
<br>
This variation, **might** affect a user's behavior.
<br>

![](./img/ab.svg)

<br>

#### Goal: Increase End User's Objective

* **Business:** Income increases >> Costs of change
* **Health Care:**  Health increases >> Side effect

:::{.notes}

* Not explicitly telling users they are in a test
* "User" is loosely used.  It could be servers, Say testing speed: Google vs AWS cloud
:::

---

### Weekly Planner Choices

::::{.columns}
:::{.column width="10%"}
:::
:::{.column width="5%"}
#### A
:::
:::{.column width="30%"}

![](img/CIRCA_JOTLET_WEEKLY.webp){width=200}

:::


:::{.column width="5%"}
#### B
:::

:::{.column}


![](img/stamp-weekly.jpg){width=200}

:::
:::{.column width="10%"}
:::
::::


#### So why do A/B Testing

::: {.incremental}

- Why spend the resources to do tests
- Why risk angering your customers with changes?
- I got data miners, I do not need tests!
  - I can find my answers in the data, thank you very much
- I am a developer, I don't need to know the business side

:::

---

### Life is complicated

Domain knowledge only gets you so far!
<br>
Subject matter experts (SME) from Microsoft, Netflixs etc, find when they implement changes 
that only a small fraction of their ideas have the planned outcome [@sweet].

<br>

Again, domain knowledge only gets you so far.

<br>

Even though we are isolating a single variable, 
that variable interacts with a million other variables.
<br>
You simply can not model everything or know everything.

::::{.columns}
:::{.column width=60%}

![](./img/10_lightbulb.webp){width=90%}

:::
::: {.column width=39%}

<br>


::: {.incremental}

- #### Any change can hurt a business.
  - Event tested changes
    - Though less likely!
- #### Change can help a business
  - "If we are not growing, we are die-ing" (old Program Manager)

:::
:::
::::

---

## Gedanken: 

::::{.columns}
:::{.column width=70%}
### Trader Janes has a New Pizza
Say there is a grocer called Trader Janes and it wants to add a new pizza to its line up.
<br>
However, they need to keep the same number of types it sells a constant.
Freezer only holds N pizzas.

<br>
They will have to remove one pizza from their lineup to add the new item.
<br>
<br>
<br>

### Typical Work flow

- Marketing asks a _Data Miner_ to rank popularity of pizza.
- The Data Miner finds the pizza that sells the least.
- Stores remove that pizza.
- Stores add new pizza.

:::
:::{.column width=29%}

![](./img/yummy-pizza-1327587.jpg){width=270,}
![](./img/marketing.svg)
:::
::::


[Arjun Kartha's pizza pic](https://www.freeimages.com/photo/yummy-pizza-1327587)

---

::::{.columns}
:::{.column width=60%}

### New Pizza added!!!
<br>



#### Unfortunately:  

A week later sales go down.

<br>
<br>

:::
:::{.column width=30%}

![](./img/sales_down.webp)

:::
::::

### What happened?

::: {.incremental}

- Don't know, because the store implemented many changes that week!
- It's the week after Thanksgiving and sales always go down that week.
- Turns out there was a small group of heavy spenders that love this pizza.

:::

<br>
<br>


#### A / B Testing help predict what changes will increase the bottom line.

---

## A / B Testing Limitations

A/B Testing is used to clarify a vision, but does not create vision.

<br>

For example, an ophthalmologist quickly gives you a set of two choices; 
1 or 2 (2 or 3) that lead to sharpen vision.  Their test, like A/B, can not give you vision.

<br>


#### Though without a clarity, </br> a vision has serious limitation.

![](./img/glasses.webp){fig-align=center width=70%}

---

## A/B Testing and DevOps


::::{.columns}
:::{.column width=25%}

<br>
<br>

How does A/B testing fit  
into the DevOps?

<br>
<br>



* (from The Pheonix Project [@pheonix])

:::
:::{.column width=75%}

### The Three Ways for DevOps 

**The First Way:** Principles of Flow

- Making work “visible” by defining a work flow


**The Second Way:** Principles of Feedback

- Have fast and constant feedback cycles throughout all stages of a development
- Don't throw it over the wall 
    
    
**Third Way:** Principles of Continuous Learning

- Create a culture of continual learning and experimentation
  
:::
::::

![](./img/devops_ways.svg){fig-align=center width=75%}


---

### A/B Testing and the Three ways

![](./img/devops_ways.svg){width=550px}

::::{.columns}
:::{.column width=65%}

<br>


A/B Testing is an extension of the<br> second and third ways.  
Feedback will be the results of the A/B Testing.
<br>
<br>

#### However
##### Experimentation happens in production!

:::
:::{.column width=35%}

![](./img/devops_ways-AB.svg)

:::
::::

---

## A/B Tests
### The good, the bad and the ugly
<br>


:::: {.columns }
::: {.column width=20% }
:::
::: {.column width=60% }


#### Rewards

- Increase companies goals: (make more successful):
  - Business: Profits
  - Healthcare: Health
  - Defence: Situational Awareness
  
:::
::::

<br>

::::{.columns}
:::{.column}

#### Risks

- Test cost time and money
- Don't know what percent of risk is acceptable
  - Medical and Defence will have lower threshold of risk
- Upset customers
- Change can makes things worse


:::
:::{.column}


#### Mitigation 

- Have the smallest test possible
- 5% False Positive 
- 20% False Negative
  - Typical of non life critical changes
- Minimize number of samples

:::
::::


---



## Reducing Costs
### Minimal Viable Product

Need to create the smallest, fastest A/B Test that has statically meaningful numbers.

<br>
<br> 

### How do you minimize the number of samples (N)?

<br>

Want an N that will have  5% false positive and 20% false negative.

<br>

$$
N = ?
$$

---

### Use Statistics 

<br>

Defines minimum number of samples (**N**) as:

$$
N > 2.48 \left( \frac{\sigma_\Delta}{\Delta} \right)^2
$$

<hr>

- $\Delta$: How much of a difference is needed to make the change
  - It cost money to make a change
  - Increase to bottom line needs to be significant, to accept risk
    -  _Example_: Trader Janes Pizza needs sales to increase by 3%
- $\sigma_\Delta$: estimated by business historical data
  - $\sigma_\Delta$ = $~\sqrt{2 \sigma_{log}^2}$
    - $\sigma_{log}$: How much does sales fluctuate 

---

### Important

<br>

- #### Unless there is a clear, measurable advantage, no change should occur.

<br>

- #### There is no guarantee that change will be effective.
    
<br>
<hr>
<br>
<br>

#### Bias and Harm

In addition, our testing and product should do **no** harm.

<br>

More on this later

---

<br><br><br>

### Where does 2.48 comes from?

---

## Rules of Thumb: 20 / 5 Rule

<br>

#### Assume there is no difference between A and B

$$
\Delta = 0 \\
 \Delta = B - A 
$$

<br>
<hr>
::::{.columns}
:::{.column}

**False positive** 

- A is better but, you implemented B
- incurs an explicit cost


<br>

:::
:::{.column}

**False negative** 

- B is better but, you stuck with A
- incurs an explicit cost

<br>

:::
::::
<hr>

::::{.columns}
:::{.column}

| $\alpha$ == **False Positive rate** (5%: 1.64)

<br>

| You can assume B is better than A


:::
:::{.column}

| $\beta$== **False Negative rate** (20%: 0.84)

<br>

| You can assume A is better than B

:::
::::

---

#### From Standard Normal Distribution

::::{.columns}
:::{.column width=25%}


**Mean** is 0

<br>

**Standard deviation:** <br>
$\sigma$ = 1

----
<br>

| $Z_{score}$ = -1.64 (**5%**)

| $Z_{score}$ = 0.84 (**20%**)

<br>

$$
1.64 + 0.84 = 2.48
$$

<br>
<br>
<br>
<br>

Graph from [@norm-dist]

:::
:::{.column width=74%}

<iframe width=720px height=530px src="norm-dist.html"></iframe>

:::
::::

---




::::{.columns}
:::{.column}

### False Positive 

| $\alpha$ == **False Positive rate** (5%: 1.64)

<br>

|  Assume: B is better than A


:::
:::{.column}

### False Negative 

| $\beta$== **False Negative rate** (20%: 0.84)

<br>

| Assume: A is better than B

:::
::::

<br>
<br>


::::{.columns}
:::{.column}


  
![](./img/z-score.png){width=450}

:::
:::{.column}

![](./img/z-score-20.png){width=485}

:::
::::

---

Yeah, we have our minimal viable test.

<br>


But we are not done yet.  

<br>

One more thing to worry about

<br>


### Can this harm our customers?

---

## Do no Harm: F potential

If we implement B, how F--ed up will that make the users?

<br>

### Social Sites
Group mindset has been around since the 1950's.
Current research shows that our minds physically change when we work together [@change-minds].

So it is scary to read A/B Testing being done on users without consent, knowledge and at this scale.
These are some of the ones we know about.

* Facebook: Tested their algorithm to see if it really does radicalize people [@facebook-radical]
* Linked-In: Tested on 20 million users to find out how links affect jobs [@linkedin-jobs]
* Facebook: 700,000 users to see if they can make them sad [@facebook-sad]

### Health Care

* Drug Companies: OxyContin [@oxycontin]
  * 1% addiction rate advertised (From non real world users)
  * 10-30% addiction rate in real life

---

### Remedy

#### Good news

There are already strong standard for testing on human subjects.  
There is the IRB (Internal review board) preprocess.

<br>

It has required and continuous training and certification: CiTI training.

<br>


#### Bad news

Only required for companies receiving federal government funding: Universities, Air Force, Army etc.

<br>

Not required for companies that work with schools (state and local funding) and social media companies.

<br>

### F potential

In light of this, I propose researchers use the F potential

---

### $F_{upped}$  Potential

$$
F_{upped} =  \begin{cases}
       \text{1,} &\quad\text{if seriously harmed}\\
       \text{0.5,} &\quad\text{if slightly harmed} \\
       \text{0,} &\quad\text{if not measurable}\\
       \text{-0.5,} &\quad\text{becomes better} \\
       \text{-1,} &\quad\text{becomes a lot better} \\
     \end{cases}
$$

If $F_{upped}$ >0, test should be a no go.

If $F_{upped}$ < 0, $\Delta$ should be halved. 

* e.g. the amount of gain the company needs to make from change, should be halved.

---



## One more thing to worry about

## Seen and Unseen Bias

Biases can increase the F-potential. 

<br>
<hr>
<br>

Luckily, A/B Testing can help with both unseen and seen bias.



---

### Example: Unseen Bias

I know of three small business that where started by **young** women 
in the Dayton area. 

<br>

Their original logo design used beautifully detailed font.

<br>

Unfortunately, this detailed font would make it difficult for people like me (over 40) to read it.

<br>
<hr>

They literally could see their logo.

<br>

#### However

Their logo was not readable to me when I drove by!

<br>
<hr>
<br>


#### This is an unseen bias.

These women (All of whom where lovely and kind) 
did not know that they made a 
logo could not be read by me.


---

### Contrast threshold function (CTF) of the Eye


![](./img/Contrast_freq.webp)

The human eye's ability to resolve a spatial frequency is dependent on contrast.
This contrast threshold function will change with age.

- At ~40 your eye will need more contrast to *see*.

---

### Logos evolve with Testing





::::{.columns}
:::{.column width="51%"}

#### Starbucks Logo Evolution

<br>
<br>

Starbucks Logo has evolved to reduce high spatial information.

<br>

- Old Logo: High frequency information 
  - thin lines
- New Logo: Medium frequency:
  - medium width lines

<br>
[@starbucks]

:::
:::{.column width="45%"}

![](./img/Starbucks-Logo-history.jpg){fig-align=center}


:::
::::


### Change Risks

- Attract more old people, alienate young
- Loyal customers might not like change

---

## Known Bias
### A/B Testing to reduce Researcher's Bias

* Frequency range of Human Voice: 90Hz to 14,000Hz
* Frequency range for the _Voice Spectrum_ over copper: 300Hz to 3,400Hz
* Men, Women and Children have different fundamental frequency

![](./img/lang_en_male_vs_female.png){width=625px}

---

### Shrill
::::{.columns}
:::{.column width=34%}

<br>

Most consonants spoken are in the 400 to 4500Hz.

<br>

With Women having most of their consonants sounds showing up in the higher frequency's.

<br>
**Green Bar** shows the cutoff for the _voice spectrum_


<br>

This caused women's voices to sound **shrill**.

:::
:::{.column width=65%}

![](./img/Long-term-average-spectrum.webp){width=700px}

:::
::::


<br>
It also made it hard to understand what they said, 
since their voice was cut off.

---

### Bias has caused women to change.

Margret Thatcher during her career changed her voice. 

  * Dropped her main vocal frequency roughly 60Hz! [@shrill]
  * Almost a 1/3!

<br>

Women's voices have dropped on average over 23Hz from 1945 to 1993. [@journalofvoice]

<br>

Women's voices have been becoming more manly.

---

### Was the Voice Spectrum Biased: Yes

In 1927 a voice spectrum had to be defined.

<br>

J.C Steinberg (from AT&T) knew that the proposed voice frequency 
cut off women's voices.  He wrote, for congress, a letter 
titled "_Understanding Women_".

<br>

He states that men traditionally have an inability to understand women execpt when there tone is soft.  
So, it is a "biological failing of women" [@shrill] that we can't understand them.  

<br>

The technology as is, is good.  

<br>

#### Market prospective

In A/B Testing, we need to think does doing A or B make the company more sucessful.

Women make up 1/2 the market.  
<br>
When another company/technology comes along 
that has cover's women's voices better, 
it is reasonable to assume that they will take over the market.

- Who has a landline?
---

### My hero: HD-VOIP
Note: Narrow Band (free to use) VOIP is 300 to 3,400Hz.

![](./img/g711-g722-frequency-response.jpg){fig-align=center}

[@voice_freq]

---

## Voice Bias in 21st century?

With more diverse workforce, a research(er) bias  will go down.  

- **True**

<br>
<hr>
<br>

##### But, there is still unseen bias in voice in the 21st century!

<br>

Google and Apple had a hard time getting voice recognition 
to work for kids [@kids_voice]

<br>

Not only do kids speak at higher frequencies than women, they have different speaking patterns.

<br>

One can not simply take an adult's voice and shift the frequency.
So ML/AI have a hard time figuring what kids are saying.

<br>

### Why kids are important

The market for voice recognition for kids looks to have a strong market growth.



---

## Conclusion


A/B testing is a **randomized** controlled experiment done **in production**.

<br>
There are two tests: A and B, in which a single variable adjusted (B Test).
<br>
<br>
This variation, **might** affect a user's behavior.
 
<br>
<hr>
<br>

### Your A/B Testing should:

* Make the company more successful.
* Follow some ethical guild lines, like the **$F_{upped}$** potential
   - If $F_{upped}$ >0, test should be a no go.
   - If $F_{upped}$ < 0, $\Delta$ should be halved. 

<br>
<hr>
<br>

### A/B Testing has Risk
No free lunch.  
Even after testing, test results might not make the company more successful.


---

## Gem City Tech

::::{.columns}
:::{.column width=69%}

GemCity TECH’s mission is to grow the local industry and the community by providing a centralized destination for technical training, workshops and providing a forum for collaborating.

<br>

Currently, support eight special interest groups from a variety of technical disciplines.

- Dayton Web Developers
- Dayton Dynamic Languages
- Dayton .net Developers
- Gem City Games Developments
- New to Tech
- Frameworks
- **Machine Learning / Artificial Intelligence (ML/AI)**
- Code for Dayton

:::
:::{.column width=30%}

![](img/qr-code.png)

:::
::::

---
## Quotes

C. Steinberg, in a brief titled “Understanding Women,” quips that “man’s traditional inability to understand women may have a basis of fact if one so wishes to interpret certain recent experiments in our Laboratories.” Steinberg’s experiments showed that the voiceband frequencies reduced the intelligibility of female speech by cutting out the higher frequency components necessary for the perception of certain consonants. [@shrill]

 Australian women found that the average frequency of female speech dropped twenty-three hertz between 1945 and 1993. Margaret Thatcher famously worked with voice coaches to hone her auditory image, dropping her voice sixty hertz between the nineteen-sixties and the nineteen-eighties. [@shrill]

Knowledge discovery in databases (KDD) is the process of discovering useful knowledge from a collection of data.

The Phoenix Project Quotes Showing 1-30 of 310
“Improving daily work is even more important than doing daily work.” [@pheonix]

“until code is in production, no value is actually being generated, because it’s merely WIP stuck in the system.” [@pheonix]

“every work center is made up of four things: the machine, the man, the method, and the measures.” [@pheonix]

[@pheonix]
Framework #1: The Phoenix Project/DevOps Handbook’s Three Ways
If you’ve read either The Phoenix Project or The DevOps Handbook, you’ve been introduced to The Three Ways framework for DevOps:

The First Way: Principles of Flow
The Second Way: Principles of Feedback
The Third Way: Principles of Continuous Learning
The First Way: Principles of Flow
The First Way is mostly concerned with accelerating the “flow” of work throughout a process. Gene Kim also refers to the First Way as Systems Thinking in his article The Three Ways: Principles Underpinning DevOps. Whether you’re calling it Flow or Systems Thinking, the principles underpinning the First Way are working toward the same end: viewing the flow of work as one continuous system (unsiloed) that can be continually refined and optimized.

Some of the key principles of the First Way are:

Making work “visible”. Unlike manufacturing processes, which are easily observable on a plant floor, the flow of software through its development lifecycle is not easily seen.
Using methods such as Kanban boards can surface the activities going on behind the scenes, 
by showing the left-to-right movement of a user story through the development phases.

Limiting work-in-progress (WIP). Keeping work-in-progress to a minimum has also been shown to accelerate work flow, because it minimizes multi-tasking and context-switching.

Reducing batch sizes. “Chunking” work into smaller pieces like a two-week sprint can also help deliver features (albeit smaller ones) and bug fixes to the customer faster. Issues are often caught earlier when those updates and additions are released sooner.

Reducing hand-offs between teams. The risk of “dropping the baton” increases as the hand-offs do. Although hand-offs can’t be completely minimized, the key is to keep the teams in tight communication with one another so that the hand-off itself is almost a non-event rather than a large ordeal with the potential for communication missteps along the way.

Identifying and removing constraints and waste. Constraints might be bottlenecks in the process, such as environments, test setup, and overly tight architecture, while waste includes things like manual work, heroics, and context-switching.
The Second Way: Principles of Feedback
The Second Way works to enable fast and constant feedback cycles throughout all stages of a development cycle.

Some of the key principles of the Second Way are:

Swarming and solving problems to build new knowledge. 
This principle fits into the “fail fast” mentality, so that teams can find issues with an implementation as soon as possible and address them early and often as iterations continue.

Pushing quality closer to source. This principle is at the core of the DevSecOps movement, 
which is concerned with addressing security concerns during the development cycle, 
instead of at the end, when rework to remediate is more difficult and costly.

Optimizing for downstream work centers. 
This principle works against the “throw it over the wall” mentality,
by underscoring that development should be just as invested in their application being deployable, working with operations to bridge that gap (and vice versa).
The Third Way: Principles of Continuous Learning
The Third Way seeks to create a culture of continual learning and experimentation within the development organization.

Some of the key principles of the Third Way are:

Enabling organizational learning and a safety culture. Leaders must help “set the tone” for the organization, making it okay to learn, make mistakes, and try again.

Institutionalizing the improvement of daily work. Improving what you do and how you accomplish it should be part of everyone’s daily thinking and call to action.

Transforming local discoveries to global improvements. Surfacing and sharing improvements at all levels will help enable a “bubble up” culture of continuous improvement.

Injecting resilience patterns into daily work. Some examples might include rehearsing failures, and working toward improving key metrics for deployment.

Leaders enforcing a learning culture. Organization-wide learning is unlikely to take hold and become pervasive unless it is sanctioned and exemplified by its leaders. So being intentional about communicating the value of learning and problem-solving is crucial to building that culture.

### References

::: {#refs}
:::